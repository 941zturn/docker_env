apiVersion: v1
kind: Deployment
metadata:
  name: deployment-slb-001
  namespace: zxcdn
  annotations:
    k8s.v1.cni.cncf.io/networks: webcache-network
  labels:
    name: cdn-slb
spec:
  replicas: 1
  selector: 
    matachLabels: cdn-slb
  template: 
    metadata: 
      labels: 
        app: cdn-slb
    spec:
      nodeSelector:
        kubernetes.io/hostname: 'infra1.hsc.redhat.ren'
      restartPolicy: Always

      containers:
      - name: slb-001-pg
        image: pg-img:1.01.01.01
        imagePullPolicy: IfNotPresent
        command: ["/usr/sbin/init"]
        env:
        - name: ROOTPATH
          value: "/mnt"
      
        volumeMounts:
        - name: host-time
          mountPath: /etc/localtime
      
        - name: resolv
          mountPath: /etc/resolv.conf
      
        - name: zoneinfo
          mountPath: /usr/share/zoneinfo  
        - name: pg-volumes
          mountPath: /mnt
    
        resources:
          requests:
            cpu: 1.0
            memory: 1024Mi
          limits:
            cpu: 1.0
            memory: 1024Mi
        securityContext:
            privileged: true

      - name: slb-001-main
        image: slb-img:6.01.04.03
        imagePullPolicy: IfNotPresent
        command: ["/usr/sbin/init"]
        ports:
        - name: mgr-port
          containerPort: 6310
          hostPort: 6310
        - name: svr-port
          containerPort: 6320
          hostPort: 6320
    
        volumeMounts:
        - name: host-time
          mountPath: /etc/localtime
        
        - name: resolv
          mountPath: /etc/resolv.conf
        
        - name: zoneinfo
          mountPath: /usr/share/zoneinfo
    
        - name: init-configmap-volumes
          mountPath: /home/zte_node/ztetool.ini
          subPath: ztetool.ini 
    
        - name: zte-node-logs-volumes
          mountPath: /home/zte_node/log/ 
       
        - name: zxagent-log-volumes
          mountPath: /home/zxagent/log
        - name: zxagent-etc-volumes
          mountPath: /home/zxagent/etc
      
        - name: slb-config-volumes
          mountPath: /home/persistence
    
        - name: slb-nginx-log-volumes
          mountPath: /home/zxcdn/slb/nginx/logs
        
        resources:
          requests:
            cpu: 1.0
            memory: 4Gi
          limits:
            cpu: 1.0
            memory: 4Gi
        securityContext:
          privileged: true

      volumes:
        - name: host-time
          hostPath:
            path: /etc/localtime
      
        - name: resolv
          hostPath:
            path: /etc/resolv.conf
      
        - name: zoneinfo
          hostPath:
            path: /usr/share/zoneinfo
      
        - name: pg-volumes
          hostPath: 
            path: /home/docker/ztecdn/slb-001/mnt
          
        - name: zxagent-log-volumes
          hostPath:
            path: /home/docker/ztecdn/slb-001/zxagent/logs
        - name: zxagent-etc-volumes
          hostPath:
            path: /home/docker/ztecdn/slb-001/zxagent/etc
        
        - name: zte-node-config-volumes
          hostPath:
            path: /home/docker/ztecdn/slb-001/zte_node/etc
        - name: zte-node-logs-volumes
          hostPath:
            path: /home/docker/ztecdn/slb-001/zte_node/logs
      
      
        - name: init-configmap-volumes
          configMap:
            name: slb-001-config
      
        - name: slb-config-volumes
          hostPath:
            path: /home/docker/ztecdn/slb-001/config
      
        - name: slb-nginx-log-volumes
          hostPath:
            path: /home/dockerztecdn/slb-001/nginx/logs