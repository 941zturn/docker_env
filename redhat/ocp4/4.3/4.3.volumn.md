# volumn test

this is for single node cluster:

https://docs.openshift.com/container-platform/4.3/storage/persistent_storage/persistent-storage-hostpath.html

## local volumn
https://docs.openshift.com/container-platform/4.3/storage/persistent_storage/persistent-storage-local.html

```bash
# on worker-0
mkdir -p /data/demo

# on helper
oc project demo
oc get sa
oc create serviceaccount -n demo demo-app
oc adm policy add-scc-to-user privileged -z demo-app

cat << EOF > demo1.yaml
---
apiVersion: "local.storage.openshift.io/v1"
kind: "LocalVolume"
metadata:
  name: "local-disks"
  namespace: "local-storage" 
spec:
  nodeSelector: 
    nodeSelectorTerms:
    - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - ip-10-0-140-183
          - ip-10-0-158-139
          - ip-10-0-164-33
  storageClassDevices:
    - storageClassName: "local-sc"
      volumeMode: Filesystem 
      fsType: xfs 
      devicePaths: 
        - /path/to/device
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: local-pvc-name 
spec:
  accessModes:
  - ReadWriteOnce
  volumeMode: Filesystem 
  resources:
    requests:
      storage: 100Gi 
  storageClassName: local-sc 
---
kind: Pod
apiVersion: v1
metadata:
  annotations:
  name: demo1
  namespace: demo
spec:
  nodeSelector:
    kubernetes.io/hostname: 'worker-0'
  restartPolicy: Always
  containers:
    - name: demo1
      image: >- 
        registry.redhat.ren:5443/docker.io/wangzheng422/centos:centos7-test
      env:
        - name: key
          value: value
      command: [ "/bin/bash", "-c", "--" ]
      args: [ "while true; do sleep 300000; done;" ]
      imagePullPolicy: Always
      securityContext:
        privileged: true
      volumeMounts:
        - mountPath: /data
          name: demo 
          readOnly: false
  serviceAccount: demo-app
  volumes:
    - name: demo 
      persistentVolumeClaim:
        claimName: localpvc 
EOF
oc apply -f demo1.yaml
```
## demo for hostpath
https://docs.openshift.com/container-platform/4.3/storage/persistent_storage/persistent-storage-local.html
```bash
cat << EOF > demo1.yaml
---
kind: Deployment
apiVersion: apps/v1
metadata:
  annotations:
  name: demo1
  namespace: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo1
  template:
    metadata:
      labels:
        app: demo1  
    spec:
      nodeSelector:
        kubernetes.io/hostname: 'worker-0'
      restartPolicy: Always
      containers:
        - name: demo1
          image: >- 
            registry.redhat.ren:5443/docker.io/wangzheng422/centos:centos7-test
          env:
            - name: key
              value: value
          command: ["/bin/bash", "-c", "--" ]
          args: [ "trap : TERM INT; sleep infinity & wait" ]
          imagePullPolicy: Always
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /data
              name: demo 
              readOnly: false
      serviceAccount: demo-app
      volumes:
        - name: demo 
          emptyDir: {}
EOF
oc apply -f demo1.yaml

oc delete -f demo1.yaml
```

## demo for emptydir
https://kubernetes.io/docs/concepts/storage/volumes/
```bash
cat << EOF > demo1.yaml
---
kind: Deployment
apiVersion: apps/v1
metadata:
  annotations:
  name: demo1
  namespace: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo1
  template:
    metadata:
      labels:
        app: demo1  
    spec:
      nodeSelector:
        kubernetes.io/hostname: 'worker-0'
      restartPolicy: Always
      containers:
        - name: demo1
          image: >- 
            registry.redhat.ren:5443/docker.io/wangzheng422/centos:centos7-test
          env:
            - name: key
              value: value
          command: ["/bin/bash", "-c", "--" ]
          args: [ "trap : TERM INT; sleep infinity & wait" ]
          imagePullPolicy: Always
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /data
              name: demo 
              readOnly: false
      serviceAccount: demo-app
      volumes:
        - name: demo 
          emptyDir: {}
EOF
oc apply -f demo1.yaml

oc delete -f demo1.yaml

```

## secret
https://docs.openshift.com/container-platform/4.3/nodes/pods/nodes-pods-secrets.html
```bash
cat << EOF > demo1.yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: test-secret
  namespace: demo
data:
  username: dmFsdWUtMQ0K     
  password: dmFsdWUtMQ0KDQo= 
stringData:
  hostname: myapp.mydomain.com 
  secret.properties: |-     
    property1=valueA
    property2=valueB
---
kind: Deployment
apiVersion: apps/v1
metadata:
  annotations:
  name: demo1
  namespace: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo1
  template:
    metadata:
      labels:
        app: demo1  
    spec:
      nodeSelector:
        kubernetes.io/hostname: 'worker-0'
      restartPolicy: Always
      containers:
        - name: demo1
          image: >- 
            registry.redhat.ren:5443/docker.io/wangzheng422/centos:centos7-test
          env:
            - name: key
              value: value
          command: ["/bin/bash", "-c", "--" ]
          args: [ "trap : TERM INT; sleep infinity & wait" ]
          imagePullPolicy: Always
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /data
              name: demo 
              readOnly: true
      serviceAccount: demo-app
      volumes:
        - name: demo 
          secret:
            secretName: test-secret
EOF
oc apply -f demo1.yaml

oc delete -f demo1.yaml

```

## configmap
https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/
```bash
cat << EOF > demo1.yaml
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: special-config
  namespace: demp
data:
  SPECIAL_LEVEL: very
  SPECIAL_TYPE: charm
---
kind: Deployment
apiVersion: apps/v1
metadata:
  annotations:
  name: demo1
  namespace: demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo1
  template:
    metadata:
      labels:
        app: demo1  
    spec:
      nodeSelector:
        kubernetes.io/hostname: 'worker-0'
      restartPolicy: Always
      containers:
        - name: demo1
          image: >- 
            registry.redhat.ren:5443/docker.io/wangzheng422/centos:centos7-test
          env:
            - name: key
              value: value
          command: ["/bin/bash", "-c", "--" ]
          args: [ "trap : TERM INT; sleep infinity & wait" ]
          imagePullPolicy: Always
          securityContext:
            privileged: true
          volumeMounts:
            - mountPath: /data
              name: demo 
              readOnly: true
      serviceAccount: demo-app
      volumes:
        - name: demo 
          configMap:
            name: special-config
EOF
oc apply -f demo1.yaml

oc delete -f demo1.yaml


```